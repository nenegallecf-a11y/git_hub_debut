performance.mark("js-parse-end:44095-ed452f8bb28587a6.js");
"use strict";(globalThis.webpackChunk_github_ui_github_ui=globalThis.webpackChunk_github_ui_github_ui||[]).push([["44095"],{38598(e,t,r){let n;r.d(t,{H:()=>T});var s=r(35750),i=r(18150),a=r(85242),o=r(88243),u=r(16213),l=r(87823),c=new WeakMap,h=new WeakSet;let AliveSession=class AliveSession extends l.ib{constructor(e,t,r,n,s){super(e,()=>(0,o._)(this,h,d).call(this),r,n,void 0,s),(0,u._)(this,h),(0,i._)(this,c,{writable:!0,value:void 0}),(0,a._)(this,c,t)}};function d(){return b((0,s._)(this,c))}async function b(e){let t=await f(e);return t&&t.url&&t.token?w(t.url,t.token):null}async function f(e){let t=await fetch(e,{headers:{Accept:"application/json"}});if(t.ok)return t.json();if(404===t.status)return null;throw Error("fetch error")}async function w(e,t){let r=await fetch(e,{method:"POST",mode:"same-origin",headers:{"Scoped-CSRF-Token":t}});if(r.ok)return r.text();throw Error("fetch error")}var p=r(70170),_=r(57387),m=r(68439),k=r(23683);function g(e,{channel:t,type:r,data:n}){for(let s of e)s.dispatchEvent(new CustomEvent(`socket:${r}`,{bubbles:!1,cancelable:!1,detail:{name:t,data:n}}))}var v=new WeakMap,y=new WeakMap,M=new WeakMap,S=new WeakMap,A=new WeakMap,E=new WeakSet;let P=class AliveSessionProxy{subscribe(e){let t=(0,s._)(this,y).add(...e);t.length&&(0,s._)(this,v).port.postMessage({subscribe:t});let r=new Set(t.map(e=>e.name)),n=e.reduce((e,t)=>{let n=t.topic.name;return(0,l.JR)(n)&&!r.has(n)&&e.add(n),e},new Set);n.size&&(0,s._)(this,v).port.postMessage({requestPresence:Array.from(n)})}unsubscribeAll(...e){let t=(0,s._)(this,y).drain(...e);t.length&&(0,s._)(this,v).port.postMessage({unsubscribe:t});let r=(0,s._)(this,M).removeSubscribers(e);this.sendPresenceMetadataUpdate(r)}updatePresenceMetadata(e){let t=new Set;for(let r of e)(0,s._)(this,M).setMetadata(r),t.add(r.channelName);this.sendPresenceMetadataUpdate(t)}sendPresenceMetadataUpdate(e){if(!e.size)return;let t=[];for(let r of e)t.push({channelName:r,metadata:(0,s._)(this,M).getChannelMetadata(r)});(0,s._)(this,v).port.postMessage({updatePresenceMetadata:t})}online(){(0,s._)(this,v).port.postMessage({online:!0})}offline(){(0,s._)(this,v).port.postMessage({online:!1})}hangup(){(0,s._)(this,v).port.postMessage({hangup:!0})}constructor(e,t,r,n,c,h){(0,u._)(this,E),(0,i._)(this,v,{writable:!0,value:void 0}),(0,i._)(this,y,{writable:!0,value:new l.m0}),(0,i._)(this,M,{writable:!0,value:new l.VH}),(0,i._)(this,S,{writable:!0,value:void 0}),(0,i._)(this,A,{writable:!0,value:new Map}),(0,a._)(this,S,c),(0,a._)(this,v,new SharedWorker(`${e}?module=true`,{name:`github-socket-worker-v3-${n}`,type:"module"})),(0,s._)(this,v).port.onmessage=({data:e})=>(0,o._)(this,E,W).call(this,e),(0,s._)(this,v).port.postMessage({connect:{url:t,refreshUrl:r,options:h}})}};function W(e){let{channel:t}=e;if("presence"===e.type){let r=(0,s._)(this,A).get(t);r||(r=(0,p.s)((e,r)=>{(0,s._)(this,S).call(this,e,r),(0,s._)(this,A).delete(t)},100),(0,s._)(this,A).set(t,r)),r((0,s._)(this,y).subscribers(t),e);return}(0,s._)(this,S).call(this,(0,s._)(this,y).subscribers(t),e)}async function C(){let e,t=(e=document.head.querySelector("link[rel=shared-web-socket-src]")?.getAttribute("href"))&&e.startsWith("/")?e:null;if(!t)return;let r=document.head.querySelector("link[rel=shared-web-socket]")?.href??null;if(!r)return;let n=document.head.querySelector("link[rel=shared-web-socket]")?.getAttribute("data-refresh-url")??null;if(!n)return;let s=document.head.querySelector("link[rel=shared-web-socket]")?.getAttribute("data-session-id")??null;if(!s)return;let i=(()=>{let e={};if(!(0,k.isSafari)()&&"SharedWorker"in window&&"true"!==(0,m.A)("localStorage").getItem("bypassSharedWorker"))try{return new P(t,r,n,s,g,e)}catch{}return new AliveSession(r,n,!1,g,e)})();return window.addEventListener("online",()=>i.online()),window.addEventListener("offline",()=>i.offline()),window.addEventListener("pagehide",()=>{"hangup"in i&&i.hangup()}),i}async function q(){return await _.G,C()}function T(){return n||(n=q())}},1964(e,t,r){r.d(t,{$:()=>a});var n=r(87823),s=r(37491);let i=new WeakMap;function a(e,t,r){let a;if(!e)throw Error("Not connected to alive");if(!t)throw Error("No channel name");let o=n.KK.parse(t);if(!o)throw Error("Invalid channel name");let u={subscriber:{dispatchEvent:e=>{e instanceof CustomEvent&&r(e.detail.data)}},topic:o},l=((a=i.get(e))||(a={subscribe:(0,s.rK)(t=>e.subscribe(t.flat())),unsubscribeAll:(0,s.rK)(t=>e.unsubscribeAll(...t))},i.set(e,a)),a);return l.subscribe([u]),{unsubscribe:()=>l.unsubscribeAll(u.subscriber)}}},37491(e,t,r){function n(){return Promise.resolve()}function s(){return new Promise(window.requestAnimationFrame)}async function i(e,t){let r,n=new Promise(t=>{r=self.setTimeout(t,e)});if(!t)return n;try{var s;await Promise.race([n,(s=t,new Promise((e,t)=>{let r=Error("aborted");r.name="AbortError",s.aborted?t(r):s.addEventListener("abort",()=>t(r))}))])}catch(e){throw self.clearTimeout(r),e}}function a(e){let t=[];return function(r){t.push(r),1===t.length&&queueMicrotask(()=>{let r=t.slice(0);t.length=0,e(r)})}}r.d(t,{G$:()=>s,k2:()=>n,rK:()=>a,uk:()=>i})},91714(e,t,r){r.d(t,{x:()=>l});var n=r(96540),s=r(82579),i=r(38598),a=r(1964),o=(r(74848),r(16522),r(87823));let u=(0,n.createContext)(null);u.displayName="AliveTestContext";function l(e,t){let r=(0,s.A)(),o=(0,n.use)(u);(0,n.useEffect)(()=>{let n=()=>{},s=!1;return async function(){if(e){if("function"==typeof o){let r=await o(e,t);r&&(n=r.unsubscribe);return}try{let o=await (0,i.H)();if(s)return;let u=(0,a.$)(o,e,t);u?.unsubscribe&&(r()?n=u.unsubscribe:u.unsubscribe())}catch(e){console.error(e)}}}(),()=>{s=!0,n()}},[e,t,r,o])}},82579(e,t,r){r.d(t,{A:()=>i});var n=r(16522),s=r(96540);function i(){let e,t,r,i=(0,n.c)(3),a=(0,s.useRef)(!1);i[0]===Symbol.for("react.memo_cache_sentinel")?(e=()=>a.current,i[0]=e):e=i[0];let o=e;return i[1]===Symbol.for("react.memo_cache_sentinel")?(t=()=>(a.current=!0,()=>{a.current=!1}),r=[],i[1]=t,i[2]=r):(t=i[1],r=i[2]),(0,s.useLayoutEffect)(t,r),o}}}]);
//# sourceMappingURL=44095-ed452f8bb28587a6-6fa9874c51c4bb38.js.map