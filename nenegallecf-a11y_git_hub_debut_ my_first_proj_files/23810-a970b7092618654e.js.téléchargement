performance.mark("js-parse-end:23810-a970b7092618654e.js");
"use strict";(globalThis.webpackChunk_github_ui_github_ui=globalThis.webpackChunk_github_ui_github_ui||[]).push([["23810"],{37977(e,t,n){n.d(t,{hF:()=>z,xR:()=>H,s_:()=>O});var r=n(74848),s=n(23131),o=n(76371),a=n(62561),i=n(68439),l=n(89223),u=n(27423),c=n(21513),d=n(59134),m=n(96540),p=n(74448),f=n(38621),g=n(40961);let h="```suggestion";function y({onChange:e,inputValue:t,sourceContentFromDiffLines:n,onInsertSuggestedChange:s,shouldInsertSuggestionOnRender:a,editorRef:i}){let l=`${h}
${n??""}
\`\`\``,u=()=>{s(),i.current?.focus();let n=""===t?l:`${t}
${l}`;(0,g.flushSync)(()=>{e(n)});let r=document.activeElement;if(!r||!(r instanceof HTMLTextAreaElement))return;let o=n.length-3;r.selectionStart=o-1,r.selectionEnd=o-1};return(0,m.useEffect)(()=>{if(a){let e=window.setTimeout(()=>u());return()=>{window.clearTimeout(e)}}},[]),(0,r.jsx)(o.n.ToolbarButton,{icon:f.FileDiffIcon,"aria-label":"Add a suggestion",onClick:u})}function b(e){let{sourceContentFromDiffLines:t}=e;return(0,r.jsx)(p.f.ToolbarButton,{telemetryId:"add_suggestion",icon:f.FileDiffIcon,"aria-label":"Add a suggestion",onClick:e=>{let n=`${h}
${t??""}
\`\`\``,r=0===e.state.doc.length?n:`
${n}`;return e.dispatch({changes:[{from:e.state.doc.length,insert:r}],selection:{anchor:e.state.doc.length+r.length-3-1}}),!0}})}y.displayName="AddSuggestionButton",b.displayName="HybridAddSuggestionButton";var j=n(79781),x=n(57249),v=n(30331),C=n(32951);function S({onSave:e,validationResult:t,children:n,trailingIcon:s,disabled:o,size:a}){let i=(0,r.jsx)(C.x,{variant:"primary",size:a,onClick:e,disabled:o||!t.isValid,trailingVisual:s&&o?f.AlertFillIcon:null,children:n});return t.isValid?i:(0,r.jsx)(v.A,{text:t.errorMessage,direction:"w","data-testid":"save-button-tooltip",children:i})}S.displayName="SaveButton";var _=n(63432),w=n(34164);let T=(0,m.createContext)(null);T.displayName="SlashCommandButtonContext";let E=({children:e,subject:t,onInsertText:n,onSave:s})=>{let o,a=(0,m.useRef)(null),i=(0,m.useRef)(null),[{top:l,left:u},c]=(0,m.useState)({top:0,left:0});(0,m.useEffect)(()=>{let e=a.current;if(!e)return;let t=e?.querySelector("textarea"),n={top:0,left:0};for(;t!==e;){if(null===t)return;n.top+=t.offsetTop,n.left+=t.offsetLeft,t=t.offsetParent instanceof HTMLElement?t.offsetParent:null}c(n)},[]),(0,m.useEffect)(()=>{let e=i.current;if(!e)return;a.current?.querySelector("textarea")&&e.reconnect?.();let t=()=>{e.querySelector(".js-slash-command-menu:not(.d-none)")||e.reconnect?.()},n=a.current?.querySelector("textarea");return n?.addEventListener("focus",t),()=>{n?.removeEventListener("focus",t)}},[]),(0,m.useEffect)(()=>{let e=i.current;if(!e)return;let t=a.current?.querySelector("textarea")||null,n=new MutationObserver(()=>{let n=a.current?.querySelector("textarea");n&&n!==t&&(t=n,e.querySelector(".js-slash-command-menu:not(.d-none)")||e.reconnect?.())});return a.current&&n.observe(a.current,{childList:!0,subtree:!0}),()=>{n.disconnect()}},[]),(0,m.useEffect)(()=>{if(!s)return;let e=i.current;if(e)return e.addEventListener("request-submit",s),()=>{e.removeEventListener("request-submit",s)}},[s]);let d=(0,m.useMemo)(()=>({onInsertText:n}),[n]);return(0,r.jsx)(_.az,{ref:a,sx:{"& .js-slash-command-menu":{mt:`${l}px`,ml:`${u}px`}},className:(0,w.$)("js-slash-command-surface","SlashCommandsProvider-module__slashCommandContainer__T0XL0cq"),children:(0,r.jsx)("slash-command-expander",{ref:i,keys:"/","data-slash-command-url":(o=`/${t.repository.nwo}/slash_apps?surface=${function(e){switch(e){case"issue_comment":return"issue_comment";case"issue":return"issue_body";case"pull_request":return"pull_request";case"commit":return"commit"}}(t.type)}`,t.id&&(o+=`&subject_gid=${t.id.id}`),o),children:(0,r.jsx)(T,{value:d,children:e})})})};E.displayName="SlashCommandsProvider";let I=()=>{let e=(0,m.use)(T);return e?(0,r.jsx)(o.n.ToolbarButton,{icon:f.DiffIgnoredIcon,"aria-label":"Slash commands",onClick:()=>e.onInsertText("/")}):null};I.displayName="SlashCommandsButton";let $=/<!-- Uploading[\s\S]*?-->/;var A=n(76434),k=n(82579),B=n(68695);function P(e){let t=(0,m.useRef)(void 0);return(0,m.useEffect)(()=>{t.current&&(t.current=void 0)},[e]),(0,m.useCallback)(()=>(t.current||(t.current=e()),t.current),[e])}async function F(e){try{let t=await (0,B.lS)(`/settings/replies${e?`?context=${e}`:""}`);return(await t.json()).map(e=>({name:e.title,content:e.body}))}catch{return[]}}async function M({subjectId:e,subjectType:t,subjectRepoId:n}){let r=e?`/${e}`:"",s="?mention_suggester=1&user_avatar=1";s=n?`${s}&repository_id=${n}`:s;let o=`/suggestions/${t}${r}${s}`,a=await (0,B.lS)(o,{method:"GET"});return await a.json()}async function R(e){try{return(await M(e)).map(e=>"login"in e?{description:e.name,identifier:e.login,avatarUrl:e.avatarUrl,participant:e.participant}:{description:e.description,identifier:e.name,avatarUrl:e.avatarUrl,participant:e.participant})}catch{return[]}}async function q({subjectId:e,subjectType:t,subjectRepoId:n}){let r=e?`/${e}`:"",s=await (0,B.lS)(`/suggestions/${t}${r}?issue_suggester=1&repository_id=${n}`,{method:"GET"});return await s.json()}async function L(e){try{let t=await q(e),n=t.icons;return t.suggestions.map(e=>({id:e.number.toString(),titleText:e.title,titleHtml:e.title,iconHtml:n[e.type]}))}catch{return[]}}let U={mentions:"loading",references:"loading",savedReplies:[]},N=[],H=o.n.ActionButton,D="comment_box_last_view_mode",O=()=>{let e=(0,i.A)("localStorage");return(0,s.G7)("markdown_experience_hybrid_editor")?e.getItem(D)??"hybrid":"edit"},z=({ref:e,"aria-describedby":t,"data-testid":n,label:p,labelledBy:f,showLabel:g,disabled:h=!1,subject:v,viewMode:C,onChangeViewMode:_,value:w,placeholder:T,onChange:B,onSave:M,onCancel:q,validationResult:H,saveButtonText:z="Save",saveButtonTrailingIcon:V=!0,actions:G,footerButtons:X,toolbarButtons:K,contentIsStale:W,fileUploadsEnabled:Y=!0,minHeightLines:J,maxHeightLines:Q,className:Z,onPrimaryAction:ee,buttonSize:et,suggestedChangesConfig:en,markdownErrorMessage:er,infoBanner:es,teamHovercardsEnabled:eo,setIsFileUploading:ea,markdownSuggestionsFetchMethod:ei="lazy",lineNumber:el,filePath:eu,startLineNumber:ec,onInputFocus:ed,generatingText:em})=>{let ep,ef=(ep=v)?"project"===ep.type?{subjectId:ep.id?.databaseId?.toString(),subjectType:ep.type}:{subjectId:ep.id?.databaseId?.toString()??ep.id?.id,subjectRepoId:ep.repository.databaseId,subjectType:"issue_comment"===ep.type?"issue":ep.type}:{},eg=v?.type==="project"?v?.id?.databaseId.toString():void 0,[eh,ey]=(0,m.useState)("eager"===ei),{mentions:eb,references:ej,emojis:ex,savedReplies:ev}=function(e={},t){let n=(0,k.A)(),r=function({subjectId:e,subjectType:t,subjectRepoId:n}){return P((0,m.useCallback)(()=>t&&("project"===t||n)?R({subjectId:e,subjectType:t,subjectRepoId:n}):Promise.resolve([]),[t,n,e]))}(e),s=function({subjectId:e,subjectType:t,subjectRepoId:n}){return P((0,m.useCallback)(async()=>t&&n?L({subjectId:e,subjectType:t,subjectRepoId:n}):Promise.resolve([]),[e,t,n]))}(e),o=function({subjectType:e}){return P((0,m.useCallback)(()=>F("issue"===e||"pull_request"===e?e:void 0),[e]))}(e),[a,i]=(0,m.useState)(U);(0,m.useEffect)(()=>{let e=async()=>{let[e,t,a]=await Promise.all([r(),s(),o()]);n()&&(e.length||t.length||a.length)&&i({mentions:e,references:t,savedReplies:a})};t&&e()},[r,s,o,n,t]);let l=(0,A.P)(t);return{...a,emojis:l.isPending?"loading":l.data??N}}(ef,eh),eC=(0,x.y)({...ef,path:eu,lineNumber:el,startCommitOid:v?.type==="project"?"":v?.comparison?.startCommitOid,startLineNumber:ec,endCommitOid:v?.type==="project"?"":v?.comparison?.endCommitOid,baseCommitOid:v?.type==="project"?"":v?.comparison?.startCommitOid,subject:v?.type==="project"?void 0:v?.pullRequestNumber}),eS=(0,j.fU)(ef.subjectRepoId?.toString(),eg),e_=(0,i.A)("localStorage"),[ew]=(0,l.I)(()=>O(),"edit"),[eT,eE]=(0,m.useState)(C??ew),[eI,e$]=(0,m.useState)(!1),eA=(0,m.useRef)(null);(0,c.T)(e??null,eA);let ek=(0,m.useRef)(null),eB=void 0!==v&&"repository"in v&&void 0!==v.repository,eP=eB&&v.repository.slashCommandsEnabled,[eF,eM]=(0,m.useState)(en?.shouldInsertSuggestedChange??!1);(0,m.useEffect)(()=>(e$(W??!1),()=>{e$(!1)}),[W]);let eR=(0,m.useMemo)(()=>eI?a.l:()=>{M?.(),eE(ew)},[M,eI,ew]);(0,m.useEffect)(()=>{eE(ew)},[ef.subjectRepoId,ef.subjectId,ew]),(0,m.useEffect)(()=>{C&&eE(C)},[C]);let eq=(0,m.useCallback)(e=>{eE(e),(0,s.G7)("markdown_experience_hybrid_editor")&&e_.setItem(D,"preview"===e?"edit":e),_?.(e)},[_,e_]),eL=(0,m.useCallback)(e=>{eA.current?.focus();try{document.execCommand("insertText",!1,e)}catch{}},[eA]),eU=(0,m.useCallback)(()=>{"lazy"!==ei||eh||ey(!0),ed?.()},[eh,ei,ed]);eI&&null!==ek.current&&window.scrollY>173&&ek.current.scrollIntoView();let eN=(0,m.useMemo)(()=>$.test(w),[w]);(0,m.useEffect)(()=>{ea&&ea(eN)},[eN,ea]);let eH=(0,m.useMemo)(()=>e=>(0,m.isValidElement)(e)&&"object"==typeof e&&"symbol"==typeof e.type&&"Symbol(react.fragment)"===String(e.type)?m.Children.toArray(e.props.children):m.Children.toArray(e),[]),eD=(0,m.useMemo)(()=>e=>eH(e).map((e,t)=>(0,m.isValidElement)(e)?(0,m.cloneElement)(e,{key:t,disabled:h||eN}):e),[eH,h,eN]),eO=(0,u.z)(!1),ez=(0,r.jsxs)(r.Fragment,{children:[eI&&(0,r.jsx)(d.A,{ref:ek,variant:"danger",className:"CommentBox-module__staleContentWarning__z4g6go7",children:"The content you are editing has changed. Please copy your edits and exit the editor."}),(0,r.jsxs)(o.n,{"aria-describedby":t,labelledBy:f,disabled:h,value:w,placeholder:void 0!==T?T:"Leave a comment",emojiSuggestions:ex,emojiTone:eO.settings.emojiTone,mentionSuggestions:eb,referenceSuggestions:ej,viewMode:eT,onChangeViewMode:eq,onChange:B,onInputFocus:eU,onRenderPreview:eC,onUploadFile:Y?eS:void 0,acceptedFileTypes:Y?(0,j.jw)(eB):void 0,onPrimaryAction:()=>{eR(),ee?.()},ref:eA,pasteUrlsAsPlainText:eO.settings.pasteUrlsAsPlainText,savedReplies:ev,monospace:eO.settings.useMonospaceFont,minHeightLines:J,maxHeightLines:Q,className:Z,teamHovercardsEnabled:eo,onSavedRepliesOpen:eU,banner:er?(0,r.jsx)(o.n.ErrorBanner,{children:er}):es,generatingText:em,hybridEditorProps:en?.showSuggestChangesButton||K?{customToolbarButtons:(0,r.jsxs)(r.Fragment,{children:[K,en?.showSuggestChangesButton&&(0,r.jsx)(b,{sourceContentFromDiffLines:en?.sourceContentFromDiffLines})]})}:void 0,children:[(0,r.jsx)(o.n.Label,{visuallyHidden:!g,children:p??"Markdown Editor"}),(0,r.jsxs)(o.n.Actions,{children:[eD(G),q&&(0,r.jsx)(o.n.ActionButton,{variant:"default",size:et,onClick:q,value:"Cancel",children:"Cancel"}),eR&&H&&(0,r.jsx)(S,{onSave:eR,validationResult:H,trailingIcon:V,disabled:h||eN,size:et,children:z})]}),(0,r.jsxs)(o.n.Toolbar,{children:[en?.showSuggestChangesButton&&(0,r.jsx)(y,{shouldInsertSuggestionOnRender:eF,inputValue:w,onChange:B,sourceContentFromDiffLines:en?.sourceContentFromDiffLines,editorRef:eA,onInsertSuggestedChange:()=>{en?.onInsertSuggestedChange(),eM(!1)}}),K,(0,r.jsx)(o.n.DefaultToolbarButtons,{}),(0,r.jsx)(I,{})]}),X&&(0,r.jsx)(o.n.Footer,{children:X})]})]});return(0,r.jsx)("div",{"data-testid":n,className:"CommentBox-module__commentBoxContainer__cDH_iX5",children:eP?(0,r.jsx)(E,{subject:v,onInsertText:eL,onSave:eR,children:ez}):ez})};z.displayName="CommentBox",z.displayName="CommentBox"},32951(e,t,n){n.d(t,{x:()=>r});let r=n(76371).n.ActionButton},76434(e,t,n){n.d(t,{P:()=>o});var r=n(49190),s=n(97286);function o(e){return(0,s.I)({queryKey:["autocomplete-emojis-for-editor"],enabled:e,queryFn:async()=>Object.entries(await (0,r.X)({queryDeps:{pathname:"/autocomplete/emojis_for_editor"}})).map(([e,[t,n]])=>({name:e,character:n,url:t})),staleTime:1/0})}},27423(e,t,n){n.d(t,{z:()=>c});var r=n(9907),s=n(68695),o=n(96540);let a={emojiTone:0,pasteUrlsAsPlainText:!1,useMonospaceFont:!1},i=new Map,l="/settings/appearance/viewer-settings";async function u(){try{let e=await (0,s.Sr)(l);if(!e.ok)throw Error(`HTTP ${e.status}`);let t=await e.json(),n=function(e){if(!e||"object"!=typeof e)return null;let t="number"==typeof e.emojiTone?e.emojiTone:a.emojiTone,n="boolean"==typeof e.pasteUrlsAsPlainText?e.pasteUrlsAsPlainText:a.pasteUrlsAsPlainText,r="boolean"==typeof e.useMonospaceFont?e.useMonospaceFont:a.useMonospaceFont;return void 0!==e.emojiTone||void 0!==e.pasteUrlsAsPlainText||void 0!==e.useMonospaceFont?{emojiTone:t,pasteUrlsAsPlainText:n,useMonospaceFont:r}:null}(t);if(!n)throw Error("Invalid response payload");return n}catch(e){throw e}}function c(e=!1){let[t,n]=(0,r.M)("user.preferences.viewer-settings",null),[s,d]=(0,o.useState)(!0),[m,p]=(0,o.useState)(!1),f=(0,o.useRef)(!1);e&&(i.clear(),f.current=!1);let g=(0,o.useCallback)(async()=>{let e=i.get(l);try{e||(e=u(),i.set(l,e));let t=await e;n(t),p(!1)}catch{p(!0)}finally{d(!1)}},[n]);return(0,o.useEffect)(()=>{f.current?d(!1):(f.current=!0,g())},[g]),{settings:t||a,loading:s,error:m&&!t}}}}]);
//# sourceMappingURL=23810-a970b7092618654e-6b999d7c6dcc1ca6.js.map